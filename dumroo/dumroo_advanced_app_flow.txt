ğŸ¤– DUMROO ADVANCED APP - APPLICATION FLOW DOCUMENTATION
================================================================

ğŸ“‹ OVERVIEW
-----------
The Advanced Dumroo App (dumroo_advanced_app.py) is a sophisticated Natural Language to SQL (NL2SQL) system 
that uses LangChain and Google Gemini Pro AI to convert natural language questions into SQL queries for 
educational data analysis with role-based access control.

ğŸ—ï¸ ARCHITECTURE & COMPONENTS
-----------------------------

1. CORE CLASS: AdvancedDumrooNL2SQL
   - Main system orchestrator
   - Handles initialization of AI components
   - Manages database connections
   - Implements RBAC (Role-Based Access Control)

2. AI INTEGRATION LAYERS:
   a) LangChain Integration (Primary Mode)
      - Uses Google Gemini Pro via LangChain
      - Advanced SQL query generation
      - Context-aware processing
   
   b) Basic Implementation (Fallback Mode)
      - Direct Google Generative AI integration
      - Keyword-based query matching
      - Template-based responses
   
   c) Template-Only Mode (Minimal Mode)
      - Pre-defined query templates
      - No AI dependency
      - Basic functionality only

ğŸ”„ APPLICATION FLOW
-------------------

INITIALIZATION PHASE:
1. Load environment variables (.env file)
2. Check for LangChain availability
3. Initialize appropriate AI mode:
   - If LangChain available â†’ Setup advanced mode
   - If only google-generativeai available â†’ Setup basic mode
   - If neither available â†’ Setup template-only mode
4. Load admin users from CSV for RBAC
5. Setup custom educational domain prompts

RUNTIME FLOW:
1. USER AUTHENTICATION
   â”œâ”€â”€ Load available users from admin_users.csv
   â”œâ”€â”€ Display user selection dropdown
   â”œâ”€â”€ Retrieve user permissions (role, grades, sections, regions)
   â””â”€â”€ Display user info in sidebar

2. QUERY PROCESSING PIPELINE
   â”œâ”€â”€ User Input (Natural Language Question)
   â”œâ”€â”€ Mode Detection:
   â”‚   â”œâ”€â”€ LangChain Mode:
   â”‚   â”‚   â”œâ”€â”€ Generate SQL using LangChain + Gemini Pro
   â”‚   â”‚   â”œâ”€â”€ Apply custom educational domain prompts
   â”‚   â”‚   â””â”€â”€ Use database schema context
   â”‚   â”œâ”€â”€ Basic Mode:
   â”‚   â”‚   â”œâ”€â”€ Keyword matching against question
   â”‚   â”‚   â”œâ”€â”€ Map to predefined query templates
   â”‚   â”‚   â””â”€â”€ Use basic AI for enhancement (if available)
   â”‚   â””â”€â”€ Template Mode:
   â”‚       â”œâ”€â”€ Simple keyword matching
   â”‚       â””â”€â”€ Return predefined queries only
   â”œâ”€â”€ RBAC Filter Application:
   â”‚   â”œâ”€â”€ Check user permissions
   â”‚   â”œâ”€â”€ Apply grade/section/region filters
   â”‚   â””â”€â”€ Modify SQL WHERE clauses
   â”œâ”€â”€ Query Execution:
   â”‚   â”œâ”€â”€ Connect to SQLite database
   â”‚   â”œâ”€â”€ Execute filtered SQL query
   â”‚   â””â”€â”€ Return results as DataFrame
   â””â”€â”€ Result Presentation:
       â”œâ”€â”€ Display data table
       â”œâ”€â”€ Show generated SQL
       â”œâ”€â”€ Provide download option
       â””â”€â”€ Display user context

3. USER INTERFACE COMPONENTS
   â”œâ”€â”€ Tab 1: Natural Language Query
   â”‚   â”œâ”€â”€ Sample question buttons
   â”‚   â”œâ”€â”€ Custom question text area
   â”‚   â”œâ”€â”€ Query execution button
   â”‚   â””â”€â”€ Results display area
   â””â”€â”€ Tab 2: Quick Queries
       â”œâ”€â”€ Pre-built query buttons
       â”œâ”€â”€ Common administrative tasks
       â””â”€â”€ Instant execution

ğŸ”§ TECHNICAL FEATURES
---------------------

NATURAL LANGUAGE PROCESSING:
- Context-aware date handling (last week, next month, etc.)
- Educational domain-specific prompts
- Proper table joins and relationships
- Performance-optimized query generation

ROLE-BASED ACCESS CONTROL:
- Super Admin: Full access to all data
- Grade Coordinator: Access to specific grades only
- Section Teacher: Access to specific sections only
- Automatic SQL query filtering based on permissions

AI CAPABILITIES:
- Google Gemini Pro integration via LangChain
- Custom prompt templates for educational domain
- Automatic SQL query optimization
- Error handling and query validation
- Fallback mechanisms for different installation levels

DATABASE INTEGRATION:
- SQLite database connection
- Pandas DataFrame result processing
- CSV export functionality
- Transaction safety

ğŸ¯ SUPPORTED QUERY TYPES
------------------------
- Student homework submission tracking
- Performance analysis by grade/subject
- Attendance monitoring and alerts
- Quiz scheduling and management
- Cross-table analytical queries
- Time-based data filtering

âš™ï¸ CONFIGURATION REQUIREMENTS
------------------------------
- GEMINI_API_KEY in environment variables
- dumroo_education.db SQLite database
- admin_users.csv for user management
- Optional: LangChain packages for advanced features
- Optional: google-generativeai for basic AI features

ğŸ”„ ERROR HANDLING & FALLBACKS
-----------------------------
1. Missing API Key â†’ Warning display, limited functionality
2. LangChain unavailable â†’ Fall back to basic implementation
3. Google AI unavailable â†’ Fall back to template-only mode
4. Database errors â†’ User-friendly error messages
5. Permission errors â†’ Access denied messages
6. Query failures â†’ SQL error reporting

ğŸ“Š OUTPUT FORMATS
-----------------
- Interactive Streamlit data tables
- CSV download files
- SQL query display for transparency
- User context information
- Success/error status messages

ğŸš€ DEPLOYMENT MODES
-------------------
1. FULL MODE: LangChain + Gemini Pro (Advanced NL2SQL)
2. BASIC MODE: Direct Gemini Pro (Keyword matching + AI)
3. MINIMAL MODE: Template-only (No AI dependencies)

This architecture ensures the application works across different installation scenarios while providing 
the best possible user experience based on available components.